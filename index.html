<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FullCalendar Event Interaction</title>
    <style>
        #calendar {
            max-width: 900px;
            margin: 0 auto;
        }

        /* 修正按鈕樣式 */
        .fc-toolbar button {
            pointer-events: auto !important;
        }
    </style>
</head>
<body>
    <div id="calendar"></div>

    <!-- 引入 FullCalendar 和 SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.8/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.8/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/interaction@6.1.8/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                buttonText: {
                    today: '今天',
                    month: '月',
                    week: '周',
                    day: '日'
                },
                selectable: true, // 啟用日期選擇
                select: function(info) {
                    var startDate = info.startStr; // 選擇的開始日期
                    var formattedEndDate = new Date(info.endStr);
                    formattedEndDate.setDate(formattedEndDate.getDate() - 1); // 減一天，符合用戶直觀範圍
                    var endDate = formattedEndDate.toISOString().split('T')[0];

                    // 顯示選擇範圍並顯示 SweetAlert2 彈出框讓用戶輸入事件內容
                    Swal.fire({
                        title: '選擇的日期範圍',
                        html: `您選擇的範圍：<br><strong>${startDate}</strong> 到 <strong>${endDate}</strong>`,
                        input: 'text',  // 讓使用者輸入事件內容
                        inputPlaceholder: '請輸入事件內容',
                        showCancelButton: true,  // 顯示取消按鈕
                        confirmButtonText: '確定',  // 確定按鈕
                        cancelButtonText: '取消',  // 取消按鈕
                        preConfirm: function(eventContent) {
                            // 檢查使用者是否輸入內容，若有則新增事件
                            if (eventContent) {
                                // 新增事件到日曆
                                calendar.addEvent({
                                    title: eventContent,  // 設定事件標題
                                    start: startDate,  // 設定事件開始日期
                                    end: info.endStr,  // 使用 FullCalendar 預設的非包含性結束日期
                                    allDay: true  // 設定為全天事件
                                });
                                return eventContent;  // 返回事件內容
                            } else {
                                return false;  // 如果沒有輸入內容則不新增事件
                            }
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // 如果用戶點擊確定，顯示新增成功的訊息
                            Swal.fire({
                                title: '事件已新增',
                                text: `您已成功新增事件：${result.value}`,
                                icon: 'success',
                                confirmButtonText: '確定'
                            });
                        }
                    });
                },
                eventClick: function(info) {
                    // FullCalendar 的結束日期是非包含性的，這裡直接減一天以符合用戶直覺
                    var startDate = info.event.startStr;
                    var endDate = info.event.end
                        ? new Date(info.event.endStr) // 修正為包含性結束日期
                        : null;

                        endDate =endDAte -1
                   // if (endDate) {
                   //     endDate.setDate(endDate.getDate() - 1); // 調整為包含性
                   // }

                    Swal.fire({
                        title: '事件詳細資訊',
                        html: `
                            <p><strong>標題：</strong>${info.event.title}</p>
                            <p><strong>開始日期：</strong>${startDate}</p>
                            <p><strong>結束日期：</strong>${endDate ? endDate.toISOString().split('T')[0] : '無'}</p> 
                        `,
                        icon: 'info',
                        confirmButtonText: '確定'
                    });
                },
                unselect: function() {
                    console.log('選擇取消');
                }
            });

            // 渲染日曆
            calendar.render();
        });
    </script>
</body>
</html>
